# AI交友网站部署指南

## 项目概述

这是一个基于React + Node.js + PostgreSQL的AI交友网站，包含以下核心功能：
- 用户注册、登录和个人资料管理
- 智能推荐匹配系统
- 实时聊天功能
- 管理员后台管理

## 技术栈

### 前端
- React 18
- TypeScript
- Tailwind CSS
- React Scripts

### 后端
- Node.js 16+
- Express 4
- PostgreSQL
- JSON Web Token (JWT) 认证

## 部署方案推荐

### 选择理由

我们选择**Render**作为部署平台，因为它提供了：
1. 免费的全栈托管服务
2. 免费的PostgreSQL数据库（512MB）
3. 自动部署功能
4. 集成的环境变量管理
5. 支持HTTPS
6. 简单易用的控制台

### 部署架构

```
┌─────────────────────────────────────────────────────────┐
│                     Render Platform                     │
├───────────────┬───────────────┬─────────────────────────┤
│  前端应用      │   后端API      │    PostgreSQL数据库     │
│  (Static Site) │  (Web Service)│                         │
└───────────────┴───────────────┴─────────────────────────┘
```

## 部署步骤

### 1. 准备工作

#### 1.1 创建Render账号

1. 访问 [Render官网](https://render.com/)
2. 点击 "Sign Up"，使用GitHub账号注册
3. 完成邮箱验证

#### 1.2 准备GitHub仓库

确保你的项目代码已经推送到GitHub仓库，仓库结构如下：

```
dating-app/
├── frontend/          # 前端代码
├── backend/           # 后端代码
└── README.md          # 项目说明
```

### 2. 部署PostgreSQL数据库

1. 登录Render控制台
2. 点击 "New" → "PostgreSQL"
3. 填写数据库配置：
   - **Name**: `dating-app-db`
   - **Region**: 选择离你最近的区域（如 `Oregon (US West)`）
   - **Database**: `dating_app`
   - **User**: 自动生成（记住这个用户名）
   - **Password**: 自动生成（记住这个密码）
4. 选择免费套餐（Free）
5. 点击 "Create Database"
6. 等待数据库创建完成（约1-2分钟）
7. 记录数据库连接信息：
   - **Internal Database URL**: 用于Render内部服务连接
   - **External Database URL**: 用于本地开发连接

### 3. 部署后端API

1. 登录Render控制台
2. 点击 "New" → "Web Service"
3. 连接GitHub仓库：
   - 选择你的项目仓库
   - 选择分支（通常为 `main`）
4. 填写服务配置：
   - **Name**: `dating-app-backend`
   - **Region**: 选择与数据库相同的区域
   - **Root Directory**: `backend`
   - **Environment**: `Node`
   - **Build Command**: `npm install`
   - **Start Command**: `npm start`
   - **Instance Type**: 选择免费套餐（Free）
5. 配置环境变量：
   - 点击 "Advanced" → "Add Environment Variable"
   - 添加以下环境变量：
     | 变量名 | 值 | 说明 |
     |--------|-----|------|
     | `DB_HOST` | 从数据库页面获取的主机名 | PostgreSQL数据库主机 |
     | `DB_PORT` | `5432` | PostgreSQL默认端口 |
     | `DB_NAME` | `dating_app` | 数据库名称 |
     | `DB_USER` | 从数据库页面获取的用户名 | 数据库用户名 |
     | `DB_PASSWORD` | 从数据库页面获取的密码 | 数据库密码 |
     | `JWT_SECRET` | 随机生成的字符串（如 `your-secret-key-123`） | JWT签名密钥 |
     | `BASE_URL` | 后端服务的URL（待部署后填写） | 用于生成正确的图片URL |
6. 点击 "Create Web Service"
7. 等待部署完成（约2-3分钟）
8. 部署完成后，记录后端服务的URL（如 `https://dating-app-backend.onrender.com`）
9. 更新环境变量中的 `BASE_URL` 为后端服务的URL

### 4. 部署前端应用

1. 登录Render控制台
2. 点击 "New" → "Static Site"
3. 连接GitHub仓库：
   - 选择你的项目仓库
   - 选择分支（通常为 `main`）
4. 填写静态网站配置：
   - **Name**: `dating-app-frontend`
   - **Region**: 选择与后端相同的区域
   - **Root Directory**: `frontend`
   - **Build Command**: `npm install && npm run build`
   - **Publish Directory**: `build`
5. 配置环境变量：
   - 点击 "Advanced" → "Add Environment Variable"
   - 添加以下环境变量：
     | 变量名 | 值 | 说明 |
     |--------|-----|------|
     | `REACT_APP_API_URL` | 后端服务的URL（如 `https://dating-app-backend.onrender.com`） | 前端调用后端API的基础URL |
6. 点击 "Create Static Site"
7. 等待部署完成（约2-3分钟）
8. 部署完成后，记录前端应用的URL（如 `https://dating-app-frontend.onrender.com`）

### 5. 配置前端API连接

1. 打开前端项目的 `src` 目录
2. 找到API配置文件（通常在 `src/api` 或 `src/services` 目录下）
3. 确保API基础URL使用环境变量 `REACT_APP_API_URL`

如果没有配置文件，可以在前端代码中直接使用环境变量：

```javascript
// 示例：在前端代码中使用API URL
const API_URL = process.env.REACT_APP_API_URL || 'http://localhost:3001';
```

### 6. 测试部署

1. 访问前端应用URL（如 `https://dating-app-frontend.onrender.com`）
2. 尝试注册新用户
3. 登录并完善个人资料
4. 查看推荐匹配
5. 测试聊天功能

## 环境变量配置

### 后端环境变量

| 变量名 | 类型 | 描述 |
|--------|------|------|
| `DB_HOST` | 字符串 | PostgreSQL数据库主机 |
| `DB_PORT` | 数字 | PostgreSQL端口，默认5432 |
| `DB_NAME` | 字符串 | 数据库名称 |
| `DB_USER` | 字符串 | 数据库用户名 |
| `DB_PASSWORD` | 字符串 | 数据库密码 |
| `JWT_SECRET` | 字符串 | JWT签名密钥 |
| `BASE_URL` | 字符串 | 后端服务的基础URL |

### 前端环境变量

| 变量名 | 类型 | 描述 |
|--------|------|------|
| `REACT_APP_API_URL` | 字符串 | 后端API的基础URL |

## 数据库初始化

后端服务启动时会自动执行数据库初始化脚本，创建所需的表结构：
- `admins` - 管理员表
- `users` - 用户表
- `interactions` - 交互记录表
- `matches` - 匹配表
- `messages` - 聊天消息表

初始管理员账号：
- 用户名：`admin`
- 密码：`admin123`

## 常见问题与解决方案

### 1. 后端连接数据库失败

**问题**：后端服务无法连接到PostgreSQL数据库

**解决方案**：
- 检查环境变量是否正确配置
- 确保数据库和后端服务在同一区域
- 检查数据库是否已成功创建
- 查看Render控制台的日志信息

### 2. 前端无法访问后端API

**问题**：前端应用无法调用后端API

**解决方案**：
- 检查前端环境变量 `REACT_APP_API_URL` 是否正确
- 确保后端服务已成功部署
- 检查后端服务的CORS配置是否允许前端域名访问
- 查看浏览器控制台的网络请求和错误信息

### 3. 部署后图片上传功能无法使用

**问题**：用户无法上传头像或照片

**解决方案**：
- 检查后端服务的 `uploads` 目录是否存在
- 确保环境变量 `BASE_URL` 已正确配置
- 检查前端是否正确处理图片上传请求

### 4. 应用响应缓慢

**问题**：应用加载或响应缓慢

**解决方案**：
- 检查Render实例是否处于活跃状态（免费实例可能会自动休眠）
- 优化前端代码，减少不必要的请求
- 优化数据库查询
- 考虑升级到付费实例

## 维护与监控

### 1. 日志查看

在Render控制台中，你可以查看每个服务的日志：
- 前端静态网站：查看构建日志和访问日志
- 后端API：查看应用运行日志和错误信息
- 数据库：查看数据库连接和查询日志

### 2. 定期备份

Render免费数据库不提供自动备份功能，建议：
- 定期导出数据库备份
- 使用GitHub Actions自动备份数据库

### 3. 依赖更新

定期更新项目依赖，确保安全性和性能：

```bash
# 前端
cd frontend
npm outdated      # 检查过时依赖
npm update        # 更新依赖

# 后端
cd backend
npm outdated      # 检查过时依赖
npm update        # 更新依赖
```

### 4. 性能监控

使用以下工具监控应用性能：
- **UptimeRobot**：监控网站可用性
- **Google Analytics**：分析网站流量和用户行为
- **Render Metrics**：查看Render服务的CPU和内存使用情况

## 自定义域名配置

### 1. 购买域名

从域名注册商（如GoDaddy、Namecheap、阿里云等）购买自定义域名。

### 2. 配置Render自定义域名

#### 2.1 后端API自定义域名

1. 登录Render控制台，进入后端服务设置
2. 点击 "Custom Domains" → "Add Custom Domain"
3. 输入你的自定义域名（如 `api.yourdomain.com`）
4. 按照提示在域名注册商处添加DNS记录
5. 等待DNS解析完成（通常1-24小时）
6. Render自动配置SSL证书

#### 2.2 前端应用自定义域名

1. 登录Render控制台，进入前端静态网站设置
2. 点击 "Custom Domains" → "Add Custom Domain"
3. 输入你的自定义域名（如 `www.yourdomain.com`）
4. 按照提示在域名注册商处添加DNS记录
5. 等待DNS解析完成（通常1-24小时）
6. Render自动配置SSL证书

## 升级部署

### 1. 更新代码

1. 在本地修改代码
2. 推送到GitHub仓库
3. Render自动检测代码变更并重新部署

### 2. 扩展服务

当应用流量增加时，可以考虑升级到付费实例：
- **Web Service**：选择 `Starter` 或 `Pro` 实例
- **PostgreSQL**：选择 `Standard` 或 `Pro` 实例

## 本地开发环境配置

### 1. 安装依赖

```bash
# 前端
cd frontend
npm install

# 后端
cd backend
npm install
```

### 2. 配置本地数据库

1. 安装PostgreSQL
2. 创建数据库 `dating_app`
3. 配置 `backend/.env` 文件：

```env
DB_HOST=localhost
DB_PORT=5432
DB_NAME=dating_app
DB_USER=postgres
DB_PASSWORD=your_local_password
JWT_SECRET=your-local-secret
BASE_URL=http://localhost:3001
```

### 3. 启动开发服务器

```bash
# 后端（在backend目录）
npm run dev

# 前端（在frontend目录）
npm start
```

### 4. 访问本地应用

- 前端：`http://localhost:3000`
- 后端：`http://localhost:3001`
- 管理员后台：`http://localhost:3000/admin`

## 总结

通过本指南，你已经成功部署了AI交友网站到Render平台。Render提供了简单易用的全栈托管服务，适合个人和小型团队部署应用。

如果遇到任何问题，可以参考：
- [Render官方文档](https://render.com/docs)
- [React官方文档](https://react.dev/)
- [Express官方文档](https://expressjs.com/)
- [PostgreSQL官方文档](https://www.postgresql.org/docs/)

祝你部署顺利！